{"version":3,"file":"createSourceFactory.js","sourceRoot":"","sources":["../../src/decorators/createSourceFactory.ts"],"names":[],"mappings":"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","sourcesContent":["declare const process: any\nimport { RefObject } from 'react'\nimport { invariant } from '@react-dnd/invariant'\nimport { DragSource, DragDropMonitor } from 'dnd-core'\nimport { DragSourceMonitor } from '../interfaces'\nimport { isPlainObject } from '../utils/js_utils'\nimport { DragSourceSpec } from './interfaces'\nimport { getDecoratedComponent } from './utils'\n\nconst ALLOWED_SPEC_METHODS = ['canDrag', 'beginDrag', 'isDragging', 'endDrag']\nconst REQUIRED_SPEC_METHODS = ['beginDrag']\n\nexport interface Source extends DragSource {\n\treceiveProps(props: any): void\n}\n\nclass SourceImpl<Props> implements Source {\n\tprivate props: Props | null = null\n\tprivate spec: DragSourceSpec<Props, any>\n\tprivate monitor: DragSourceMonitor\n\tprivate ref: RefObject<any>\n\n\tpublic constructor(\n\t\tspec: DragSourceSpec<Props, any>,\n\t\tmonitor: DragSourceMonitor,\n\t\tref: RefObject<any>,\n\t) {\n\t\tthis.spec = spec\n\t\tthis.monitor = monitor\n\t\tthis.ref = ref\n\t}\n\n\tpublic receiveProps(props: Props) {\n\t\tthis.props = props\n\t}\n\n\tpublic canDrag() {\n\t\tif (!this.props) {\n\t\t\treturn false\n\t\t}\n\t\tif (!this.spec.canDrag) {\n\t\t\treturn true\n\t\t}\n\n\t\treturn this.spec.canDrag(this.props, this.monitor)\n\t}\n\n\tpublic isDragging(globalMonitor: DragDropMonitor, sourceId: string) {\n\t\tif (!this.props) {\n\t\t\treturn false\n\t\t}\n\t\tif (!this.spec.isDragging) {\n\t\t\treturn sourceId === globalMonitor.getSourceId()\n\t\t}\n\n\t\treturn this.spec.isDragging(this.props, this.monitor)\n\t}\n\n\tpublic beginDrag = () => {\n\t\tif (!this.props) {\n\t\t\treturn\n\t\t}\n\n\t\tconst item = this.spec.beginDrag(this.props, this.monitor, this.ref.current)\n\t\tif (process.env.NODE_ENV !== 'production') {\n\t\t\tinvariant(\n\t\t\t\tisPlainObject(item),\n\t\t\t\t'beginDrag() must return a plain object that represents the dragged item. ' +\n\t\t\t\t\t'Instead received %s. ' +\n\t\t\t\t\t'Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',\n\t\t\t\titem,\n\t\t\t)\n\t\t}\n\t\treturn item\n\t}\n\n\tpublic endDrag() {\n\t\tif (!this.props) {\n\t\t\treturn\n\t\t}\n\t\tif (!this.spec.endDrag) {\n\t\t\treturn\n\t\t}\n\n\t\tthis.spec.endDrag(this.props, this.monitor, getDecoratedComponent(this.ref))\n\t}\n}\n\nexport function createSourceFactory<Props, DragObject = any>(\n\tspec: DragSourceSpec<Props, DragObject>,\n) {\n\tObject.keys(spec).forEach((key) => {\n\t\tinvariant(\n\t\t\tALLOWED_SPEC_METHODS.indexOf(key) > -1,\n\t\t\t'Expected the drag source specification to only have ' +\n\t\t\t\t'some of the following keys: %s. ' +\n\t\t\t\t'Instead received a specification with an unexpected \"%s\" key. ' +\n\t\t\t\t'Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',\n\t\t\tALLOWED_SPEC_METHODS.join(', '),\n\t\t\tkey,\n\t\t)\n\t\tinvariant(\n\t\t\ttypeof (spec as any)[key] === 'function',\n\t\t\t'Expected %s in the drag source specification to be a function. ' +\n\t\t\t\t'Instead received a specification with %s: %s. ' +\n\t\t\t\t'Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',\n\t\t\tkey,\n\t\t\tkey,\n\t\t\t(spec as any)[key],\n\t\t)\n\t})\n\tREQUIRED_SPEC_METHODS.forEach((key) => {\n\t\tinvariant(\n\t\t\ttypeof (spec as any)[key] === 'function',\n\t\t\t'Expected %s in the drag source specification to be a function. ' +\n\t\t\t\t'Instead received a specification with %s: %s. ' +\n\t\t\t\t'Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',\n\t\t\tkey,\n\t\t\tkey,\n\t\t\t(spec as any)[key],\n\t\t)\n\t})\n\n\treturn function createSource(\n\t\tmonitor: DragSourceMonitor,\n\t\tref: RefObject<any>,\n\t) {\n\t\treturn new SourceImpl(spec, monitor, ref) as Source\n\t}\n}\n"]}